<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRUD! üòõ</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <!-- Î∂ÄÏÑú Ï∂îÍ∞Ä ÌåùÏóÖ -->
      <div class="write-popup">
        <div class="editor">
          <div class="input-box">
            <label>Í≥ºÏ†ï Î≤àÌò∏ : </label>
            <input type="number" id="lessonIdInsert" placeholder="Í≥ºÏ†ïÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." />
          </div>
          <div class="input-box">
            <label>Í≥ºÏ†ï Î™Ö : </label>
            <input type="text" id="lessonNameInsert" placeholder="Í≥ºÏ†ïÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." />
          </div>
          <div class="input-box">
            <label>Í≥ºÏ†ï Ìò∏Ïã§ : </label>
            <input type="text" id="lessonRoomInsert" placeholder="Í≥ºÏ†ïÌò∏Ïã§ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." />
          </div>
          <div class="input-box">
            <label>Í≥ºÏ†ï Í∏∞Í∞Ñ : </label>
            <input type="date" id="lessonStartDayInsert" value="2022-08-01" placeholder="Í≥ºÏ†ï ÏãúÏûë ÎÇ†ÏßúÏûÖÎ†•..." />
            <input type="date" id="lessonEndDayInsert" value="2023-02-06" placeholder="Í≥ºÏ†ï Ï¢ÖÎ£å ÎÇ†ÏßúÏûÖÎ†•..." />
          </div>
          <div class="input-box">
            <label>Îã¥Îãπ ÍµêÏÇ¨ : </label>
            <input type="text" id="lessonTeacherInsert" placeholder="ÍµêÏÇ¨Ïù¥Î¶Ñ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." />
          </div>
          <div class="btn-area">
            <a href="#" class="btn-cancel" onclick="">Ï∑®ÏÜå</a>
            <a href="#" class="btn-success" onclick="insertLesson()">Îì±Î°ù</a>
          </div>
        </div>
      </div>
      <!-- Î∂ÄÏÑú ÏàòÏ†ï -->
      <div class="update-popup">
        <div class="editor">
          <div class="close">
            <a href="#" class="btn-close">Îã´Í∏∞</a>
          </div>
          <div class="input-box">
            <label>Í≥ºÏ†ï Î≤àÌò∏ : </label>
            <input type="number" id="lessonIdUpdate" placeholder="Í≥ºÏ†ïÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." />
          </div>
          <div class="input-box">
            <label>Í≥ºÏ†ï Î™Ö : </label>
            <input type="text" id="lessonNameUpdate" placeholder="Í≥ºÏ†ïÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." />
          </div>
          <div class="input-box">
            <label>Í≥ºÏ†ï Ìò∏Ïã§ : </label>
            <input type="text" id="lessonRoomUpdate" placeholder="Í≥ºÏ†ïÌò∏Ïã§ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." />
          </div>
          <div class="input-box">
            <label>Í≥ºÏ†ï Í∏∞Í∞Ñ : </label>
            <input type="date" id="lessonStartDayUpdate" placeholder="Í≥ºÏ†ï ÏãúÏûë ÎÇ†ÏßúÏûÖÎ†•..." />
            <input type="date" id="lessonEndDayUpdate" placeholder="Í≥ºÏ†ï Ï¢ÖÎ£å ÎÇ†ÏßúÏûÖÎ†•..." />
          </div>
          <div class="input-box">
            <label>Îã¥Îãπ ÍµêÏÇ¨ : </label>
            <input type="text" id="lessonTeacherUpdate" placeholder="ÍµêÏÇ¨Ïù¥Î¶Ñ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." />
          </div>
          <div class="btn-area">
            <a href="#" class="btn-update" onclick="updateLesson()">ÏàòÏ†ï</a>
            <a href="#" class="btn-delete" onclick="deleteLesson()">ÏÇ≠Ï†ú</a>
          </div>
        </div>
      </div>
      <div class="navigation">
        <ul>
          <li>
            <a href="#">
              <span class="icon"><ion-icon name="logo-apple"></ion-icon></span>
              <span class="title">DW ADMIN</span>
            </a>
          </li>
          <li>
            <a href="#" onclick="goToStudentPage()">
              <span class="icon"><ion-icon name="home-outline"></ion-icon></span>
              <span class="title">ÌïôÏÉù Î™©Î°ù</span>
            </a>
          </li>
          <li>
            <a href="#" onclick="goToLessonPage()">
              <span class="icon"><ion-icon name="person-outline"></ion-icon></span>
              <span class="title">Í≥ºÏ†ï Î™©Î°ù</span>
            </a>
          </li>
          <!-- <li>
            <a href="#">
              <span class="icon"><ion-icon name="log-out-outline"></ion-icon></span>
              <span class="title">Sign Out</span>
            </a>
          </li> -->
        </ul>
      </div>
    </div>
    <!-- main -->
    <div class="main">
      <!-- table -->
      <div class="details">
        <div class="recentOrders">
          <div class="cardHeader">
            <h2>Í≥ºÏ†ï Î™©Î°ù</h2>
            <a href="#" onclick="addSubject()" class="btn">Í≥ºÏ†ï Ï∂îÍ∞Ä</a>
          </div>
          <table>
            <thead>
              <tr>
                <th>Í≥ºÏ†ï Î≤àÌò∏</th>
                <th>Í≥ºÏ†ï Ïù¥Î¶Ñ</th>
                <th>Í≥ºÏ†ï Ìò∏Ïã§</th>
                <th>Í≥ºÏ†ï Í∏∞Í∞Ñ</th>
                <th>Îã¥Îãπ ÍµêÏÇ¨</th>
              </tr>
            </thead>
            <tbody id="data">
              <!-- tbody ÎÇ¥Î∂Ä ÏßÄÏö∞Í≥† jquryÎ°ú tr td ÏÉùÏÑ±ÌïòÍ∏∞, <tr onclick="getSubject()"> -->
            </tbody>
          </table>
          <!-- ÌéòÏù¥Ïßï Ï≤òÎ¶¨ÌïòÎäî HTML -->
          <div class="pagination">
            <a>Previous</a>
            <a>1</a>
            <a>2</a>
            <a>3</a>
            <a>4</a>
            <a>5</a>
            <a>Next</a>
          </div>
        </div>
      </div>
    </div>
  </body>
  <!-- Icon CDN -->
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <!-- Jquery CDN -->
  <script
    src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
    crossorigin="anonymous"
  ></script>
  <script>
    
    // ÌéòÏù¥ÏßÄ Ïù¥Îèô(navi)
    function goToLessonPage(){
      location.href = '/lesson-page';
    }
    function goToStudentPage(){
      location.href = '/student-page';
    }


    // Í∞ïÏùò Ï†ïÎ≥¥ Ï†ÑÏ≤¥ select
    window.onload = function(){
      // AJAX: Ï†ÑÏ≤¥ Ï°∞Ìöå
      $.ajax({
          url: '/lesson',
          type: 'GET',
          dataType: 'json',
          success: function (response) {
            var out_table = "";
            for (var j = 0; j < response.length; j++) {
              out_table += "<tr onclick='getSubject(" + response[j].lessonId + ")'>"
            			  + "<td>" + response[j].lessonId + "</td>"
            			  + "<td>" + response[j].lessonName + "</td>"
            			  + "<td>" + response[j].lessonRoom + "</td>"
            			  + "<td>" + response[j].lessonStartDay + " ~ " + response[j].lessonEndDay + "</td>"
            			  + "<td>" + response[j].lessonTeacher + "</td>"
            			  +"</tr>";
            }
            $("#data").append(out_table);
          }
      }); 
    }


    // Í∞ïÏùò Ï†ïÎ≥¥ insert
    function insertLesson(){
      var lessonId = $("#lessonIdInsert").val();      // auto increment Ïô∏Ïùò id Îã¥ÏùÑ Ïª¨Îüº ÎßåÎì§Ïñ¥Ïïº Ìï®
      var lessonName = $("#lessonNameInsert").val();
      var lessonRoom = $("#lessonRoomInsert").val();
      var lessonStartDay = $("#lessonStartDayInsert").val();
      var lessonEndDay = $("#lessonEndDayInsert").val();
      var lessonTeacher = $("#lessonTeacherInsert").val();

      var jsonData = {
          "lessonId" : lessonId,
          "lessonName" : lessonName,
          "lessonRoom" : lessonRoom,
          "lessonStartDay" : lessonStartDay,
          "lessonEndDay" : lessonEndDay,
          "lessonTeacher" : lessonTeacher
      }

      $.ajax({
          url: '/lesson',
          type:'POST',
          contentType: 'application/json',
          data: JSON.stringify(jsonData),
          dataType: 'json',
          success: function(response){
            alert("Í∞ïÏùò Îì±Î°ù ÏôÑÎ£å...!");
            location.reload();
          }
      });

    }


    // Í∞ïÏùò Ï†ïÎ≥¥ update
    function updateLesson(){
      var lessonId = $("#lessonIdUpdate").val();
      var lessonName = $("#lessonNameUpdate").val();
      var lessonRoom = $("#lessonRoomUpdate").val();
      var lessonStartDay = $("#lessonStartDayUpdate").val();
      var lessonEndDay = $("#lessonEndDayUpdate").val();
      var lessonTeacher = $("#lessonTeacherUpdate").val();
		
		  var jsonData = {
          "lessonId" : lessonId,
          "lessonName" : lessonName,
          "lessonRoom" : lessonRoom,
          "lessonStartDay" : lessonStartDay,
          "lessonEndDay" : lessonEndDay,
          "lessonTeacher" : lessonTeacher
		  }
			
		// AJAX
	    $.ajax({
	        url: '/lesson',
	        type:'PATCH',
	        contentType: 'application/json',
	        data: JSON.stringify(jsonData),
	        dataType: 'json',
	        success: function(response){
	        	alert("Í∞ïÏùò Ï†ïÎ≥¥ ÏàòÏ†ï ÏôÑÎ£å...!");
	        	location.reload();
	        }
	    });

    }


    // Í∞ïÏùò Ï†ïÎ≥¥ delete
    function deleteLesson(){
      var lessonId = $("#lessonIdUpdate").val();
		
      if(lessonId == "") {
        alert("Í∞ïÏùò Î≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
        $("#lessonIdUpdate").focus();
        return false;
      }
      
      // AJAX
      $.ajax({
          url: '/lesson/' + lessonId,
          type:'DELETE',
          dataType: 'json',
          success: function(response){
            alert("Í∞ïÏùò Ï†ïÎ≥¥ Ï†úÍ±∞ ÏôÑÎ£å...!");
            location.reload();
          }
      });

    }


    $('.btn-cancel').click(function () {
      $('.write-popup').css('display', 'none');
    });
    $('.btn-close').click(function () {
      $('.update-popup').css('display', 'none');
    });
    let list = document.querySelectorAll('.navigation li');
    function activeLink() {
      list.forEach((item) => {
        item.classList.remove('hovered');
      });
      this.classList.add('hovered');
    }
    list.forEach((item) => {
      item.addEventListener('mouseover', activeLink);
    });

    function getSubject(lessonId) {
      $('.update-popup').css('display', 'block');


      // AJAX: Í∞ïÏùò ÏÉÅÏÑ∏Ï†ïÎ≥¥ select
	    $.ajax({
          url: '/lesson/' + lessonId,
          type: 'GET',
          dataType: 'json',
          success: function (response) {
          	$("#lessonIdUpdate").val(response.lessonId);
            $("#lessonNameUpdate").val(response.lessonName);
            $("#lessonRoomUpdate").val(response.lessonRoom);
            $("#lessonStartDayUpdate").val(response.lessonStartDay);
            $("#lessonEndDayUpdate").val(response.lessonEndDay);
            $("#lessonTeacherUpdate").val(response.lessonTeacher);
          }
      });

    }


    function addSubject() {
      $('.write-popup').css('display', 'block');
    }
  </script>
</html>
